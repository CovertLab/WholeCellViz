var Pixastic=(function(){function d(m,n,l){if(m.addEventListener){m.addEventListener(n,l,false)}else{if(m.attachEvent){m.attachEvent("on"+n,l)}}}function g(n){var l=false;var o=function(){if(!l){l=true;n()}};document.write('<script defer src="//:" id="__onload_ie_pixastic__"><\/script>');var m=document.getElementById("__onload_ie_pixastic__");m.onreadystatechange=function(){if(m.readyState=="complete"){m.parentNode.removeChild(m);o()}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",o,false)}d(window,"load",o)}function k(){var l=c("pixastic",null,"img");var o=c("pixastic",null,"canvas");var n=l.concat(o);for(var m=0;m<n.length;m++){(function(){var q=n[m];var s=[];var r=q.className.split(" ");for(var v=0;v<r.length;v++){var x=r[v];if(x.substring(0,9)=="pixastic-"){var u=x.substring(9);if(u!=""){s.push(u)}}}if(s.length){if(q.tagName.toLowerCase()=="img"){var p=new Image();p.src=q.src;if(p.complete){for(var w=0;w<s.length;w++){var t=Pixastic.applyAction(q,q,s[w],null);if(t){q=t}}}else{p.onload=function(){for(var y=0;y<s.length;y++){var z=Pixastic.applyAction(q,q,s[y],null);if(z){q=z}}}}}else{setTimeout(function(){for(var y=0;y<s.length;y++){var z=Pixastic.applyAction(q,q,s[y],null);if(z){q=z}}},1)}}})()}}if(typeof pixastic_parseonload!="undefined"&&pixastic_parseonload){g(k)}function c(r,p,l){var o=new Array();if(p==null){p=document}if(l==null){l="*"}var n=p.getElementsByTagName(l);var m=n.length;var q=new RegExp("(^|\\s)"+r+"(\\s|$)");for(i=0,j=0;i<m;i++){if(q.test(n[i].className)){o[j]=n[i];j++}}return o}var e;function a(m,n){if(!Pixastic.debug){return}try{switch(n){case"warn":console.warn("Pixastic:",m);break;case"error":console.error("Pixastic:",m);break;default:console.log("Pixastic:",m)}}catch(l){}if(!e){}}var b=(function(){var n=document.createElement("canvas");var m=false;try{m=!!((typeof n.getContext=="function")&&n.getContext("2d"))}catch(l){}return function(){return m}})();var f=(function(){var o=document.createElement("canvas");var n=false;var l;try{if(typeof o.getContext=="function"&&(l=o.getContext("2d"))){n=(typeof l.getImageData=="function")}}catch(m){}return function(){return n}})();var h=(function(){var n=false;var p=document.createElement("canvas");if(b()&&f()){p.width=p.height=1;var o=p.getContext("2d");o.fillStyle="rgb(255,0,0)";o.fillRect(0,0,1,1);var l=document.createElement("canvas");l.width=l.height=1;var q=l.getContext("2d");q.fillStyle="rgb(0,0,255)";q.fillRect(0,0,1,1);o.globalAlpha=0.5;o.drawImage(l,0,0);var m=o.getImageData(0,0,1,1).data;n=(m[2]!=255)}return function(){return n}})();return{parseOnLoad:false,debug:false,applyAction:function(E,p,o,n){n=n||{};var r=(E.tagName.toLowerCase()=="canvas");if(r&&Pixastic.Client.isIE()){if(Pixastic.debug){a("Tried to process a canvas element but browser is IE.")}return false}var m,v;var u=false;if(Pixastic.Client.hasCanvas()){u=!!n.resultCanvas;m=n.resultCanvas||document.createElement("canvas");v=m.getContext("2d")}var t=E.offsetWidth;var x=E.offsetHeight;if(r){t=E.width;x=E.height}if(t==0||x==0){if(E.parentNode==null){var s=E.style.position;var C=E.style.left;E.style.position="absolute";E.style.left="-9999px";document.body.appendChild(E);t=E.offsetWidth;x=E.offsetHeight;document.body.removeChild(E);E.style.position=s;E.style.left=C}else{if(Pixastic.debug){a("Image has 0 width and/or height.")}return}}if(o.indexOf("(")>-1){var A=o;o=A.substr(0,A.indexOf("("));var q=A.match(/\((.*?)\)/);if(q[1]){q=q[1].split(";");for(var B=0;B<q.length;B++){thisArg=q[B].split("=");if(thisArg.length==2){if(thisArg[0]=="rect"){var l=thisArg[1].split(",");n[thisArg[0]]={left:parseInt(l[0],10)||0,top:parseInt(l[1],10)||0,width:parseInt(l[2],10)||0,height:parseInt(l[3],10)||0}}else{n[thisArg[0]]=thisArg[1]}}}}}if(!n.rect){n.rect={left:0,top:0,width:t,height:x}}else{n.rect.left=Math.round(n.rect.left);n.rect.top=Math.round(n.rect.top);n.rect.width=Math.round(n.rect.width);n.rect.height=Math.round(n.rect.height)}var y=false;if(Pixastic.Actions[o]&&typeof Pixastic.Actions[o].process=="function"){y=true}if(!y){if(Pixastic.debug){a('Invalid action "'+o+'". Maybe file not included?')}return false}if(!Pixastic.Actions[o].checkSupport()){if(Pixastic.debug){a('Action "'+o+'" not supported by this browser.')}return false}if(Pixastic.Client.hasCanvas()){if(m!==E){m.width=t;m.height=x}if(!u){m.style.width=t+"px";m.style.height=x+"px"}v.drawImage(p,0,0,t,x);if(!E.__pixastic_org_image){m.__pixastic_org_image=E;m.__pixastic_org_width=t;m.__pixastic_org_height=x}else{m.__pixastic_org_image=E.__pixastic_org_image;m.__pixastic_org_width=E.__pixastic_org_width;m.__pixastic_org_height=E.__pixastic_org_height}}else{if(Pixastic.Client.isIE()&&typeof E.__pixastic_org_style=="undefined"){E.__pixastic_org_style=E.style.cssText}}var z={image:E,canvas:m,width:t,height:x,useData:true,options:n};var D=Pixastic.Actions[o].process(z);if(!D){return false}if(Pixastic.Client.hasCanvas()){if(z.useData){if(Pixastic.Client.hasCanvasImageData()){m.getContext("2d").putImageData(z.canvasData,n.rect.left,n.rect.top);m.getContext("2d").fillRect(0,0,0,0)}}if(!n.leaveDOM){m.title=E.title;m.imgsrc=E.imgsrc;if(!r){m.alt=E.alt}if(!r){m.imgsrc=E.src}m.className=E.className;m.style.cssText=E.style.cssText;m.name=E.name;m.tabIndex=E.tabIndex;m.id=E.id;if(E.parentNode&&E.parentNode.replaceChild){E.parentNode.replaceChild(m,E)}}n.resultCanvas=m;return m}return E},prepareData:function(q,m){var l=q.canvas.getContext("2d");var o=q.options.rect;var n=l.getImageData(o.left,o.top,o.width,o.height);var p=n.data;if(!m){q.canvasData=n}return p},process:function(m,l,n,q){if(m.tagName.toLowerCase()=="img"){var p=new Image();p.src=m.src;if(p.complete){var o=Pixastic.applyAction(m,p,l,n);if(q){q(o)}return o}else{p.onload=function(){var r=Pixastic.applyAction(m,p,l,n);if(q){q(r)}}}}if(m.tagName.toLowerCase()=="canvas"){var o=Pixastic.applyAction(m,m,l,n);if(q){q(o)}return o}},revert:function(l){if(Pixastic.Client.hasCanvas()){if(l.tagName.toLowerCase()=="canvas"&&l.__pixastic_org_image){l.width=l.__pixastic_org_width;l.height=l.__pixastic_org_height;l.getContext("2d").drawImage(l.__pixastic_org_image,0,0);if(l.parentNode&&l.parentNode.replaceChild){l.parentNode.replaceChild(l.__pixastic_org_image,l)}return l}}else{if(Pixastic.Client.isIE()){if(typeof l.__pixastic_org_style!="undefined"){l.style.cssText=l.__pixastic_org_style}}}},Client:{hasCanvas:b,hasCanvasImageData:f,hasGlobalAlpha:h,isIE:function(){return !!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}})();if(typeof jQuery!="undefined"&&jQuery&&jQuery.fn){jQuery.fn.pixastic=function(c,b){var a=[];this.each(function(){if(this.tagName.toLowerCase()=="img"&&!this.complete){return}var d=Pixastic.process(this,c,b);if(d){a.push(d)}});if(a.length>0){return jQuery(a)}else{return this}}}Pixastic.Actions.blend={process:function(c){var k=parseFloat(c.options.amount);var m=(c.options.mode||"normal").toLowerCase();var e=c.options.image;k=Math.max(0,Math.min(1,k));if(!e){return false}if(Pixastic.Client.hasCanvasImageData()){var D=c.options.rect;var R=Pixastic.prepareData(c);var F=D.width;var O=D.height;c.useData=false;var E=document.createElement("canvas");E.width=c.canvas.width;E.height=c.canvas.height;var Q=E.getContext("2d");Q.drawImage(e,0,0);var t={canvas:E,options:c.options};var K=Pixastic.prepareData(t);var n=t.canvasData;var H=F*O;var C=H*4;var l,f;var u,N,B;var s,M,A;var q,L,z;var o,J,y;var v=false;switch(m){case"normal":break;case"multiply":while(H--){K[C-=4]=R[C]*K[C]/255;K[l=C+1]=R[l]*K[l]/255;K[f=C+2]=R[f]*K[f]/255}v=true;break;case"lighten":while(H--){if((u=R[C-=4])>K[C]){K[C]=u}if((N=R[l=C+1])>K[l]){K[l]=N}if((B=R[f=C+2])>K[f]){K[f]=B}}v=true;break;case"darken":while(H--){if((u=R[C-=4])<K[C]){K[C]=u}if((N=R[l=C+1])<K[l]){K[l]=N}if((B=R[f=C+2])<K[f]){K[f]=B}}v=true;break;case"darkercolor":while(H--){if(((u=R[C-=4])*0.3+(N=R[l=C+1])*0.59+(B=R[f=C+2])*0.11)<=(K[C]*0.3+K[l]*0.59+K[f]*0.11)){K[C]=u;K[l]=N;K[f]=B}}v=true;break;case"lightercolor":while(H--){if(((u=R[C-=4])*0.3+(N=R[l=C+1])*0.59+(B=R[f=C+2])*0.11)>(K[C]*0.3+K[l]*0.59+K[f]*0.11)){K[C]=u;K[l]=N;K[f]=B}}v=true;break;case"lineardodge":while(H--){if((q=R[C-=4]+K[C])>255){K[C]=255}else{K[C]=q}if((L=R[l=C+1]+K[l])>255){K[l]=255}else{K[l]=L}if((z=R[f=C+2]+K[f])>255){K[f]=255}else{K[f]=z}}v=true;break;case"linearburn":while(H--){if((q=R[C-=4]+K[C])<255){K[C]=0}else{K[C]=(q-255)}if((L=R[l=C+1]+K[l])<255){K[l]=0}else{K[l]=(L-255)}if((z=R[f=C+2]+K[f])<255){K[f]=0}else{K[f]=(z-255)}}v=true;break;case"difference":while(H--){if((q=R[C-=4]-K[C])<0){K[C]=-q}else{K[C]=q}if((L=R[l=C+1]-K[l])<0){K[l]=-L}else{K[l]=L}if((z=R[f=C+2]-K[f])<0){K[f]=-z}else{K[f]=z}}v=true;break;case"screen":while(H--){K[C-=4]=(255-(((255-K[C])*(255-R[C]))>>8));K[l=C+1]=(255-(((255-K[l])*(255-R[l]))>>8));K[f=C+2]=(255-(((255-K[f])*(255-R[f]))>>8))}v=true;break;case"exclusion":var I=2/255;while(H--){K[C-=4]=(u=R[C])-(u*I-1)*K[C];K[l=C+1]=(N=R[l])-(N*I-1)*K[l];K[f=C+2]=(B=R[f])-(B*I-1)*K[f]}v=true;break;case"overlay":var I=2/255;while(H--){if((u=R[C-=4])<128){K[C]=K[C]*u*I}else{K[C]=255-(255-K[C])*(255-u)*I}if((N=R[l=C+1])<128){K[l]=K[l]*N*I}else{K[l]=255-(255-K[l])*(255-N)*I}if((B=R[f=C+2])<128){K[f]=K[f]*B*I}else{K[f]=255-(255-K[f])*(255-B)*I}}v=true;break;case"softlight":var I=2/255;while(H--){if((u=R[C-=4])<128){K[C]=((K[C]>>1)+64)*u*I}else{K[C]=255-(191-(K[C]>>1))*(255-u)*I}if((N=R[l=C+1])<128){K[l]=((K[l]>>1)+64)*N*I}else{K[l]=255-(191-(K[l]>>1))*(255-N)*I}if((B=R[f=C+2])<128){K[f]=((K[f]>>1)+64)*B*I}else{K[f]=255-(191-(K[f]>>1))*(255-B)*I}}v=true;break;case"hardlight":var I=2/255;while(H--){if((s=K[C-=4])<128){K[C]=R[C]*s*I}else{K[C]=255-(255-R[C])*(255-s)*I}if((M=K[l=C+1])<128){K[l]=R[l]*M*I}else{K[l]=255-(255-R[l])*(255-M)*I}if((A=K[f=C+2])<128){K[f]=R[f]*A*I}else{K[f]=255-(255-R[f])*(255-A)*I}}v=true;break;case"colordodge":while(H--){if((q=(R[C-=4]<<8)/(255-(s=K[C])))>255||s==255){K[C]=255}else{K[C]=q}if((L=(R[l=C+1]<<8)/(255-(M=K[l])))>255||M==255){K[l]=255}else{K[l]=L}if((z=(R[f=C+2]<<8)/(255-(A=K[f])))>255||A==255){K[f]=255}else{K[f]=z}}v=true;break;case"colorburn":while(H--){if((q=255-((255-R[C-=4])<<8)/K[C])<0||K[C]==0){K[C]=0}else{K[C]=q}if((L=255-((255-R[l=C+1])<<8)/K[l])<0||K[l]==0){K[l]=0}else{K[l]=L}if((z=255-((255-R[f=C+2])<<8)/K[f])<0||K[f]==0){K[f]=0}else{K[f]=z}}v=true;break;case"linearlight":while(H--){if(((q=2*(s=K[C-=4])+R[C]-256)<0)||(s<128&&q<0)){K[C]=0}else{if(q>255){K[C]=255}else{K[C]=q}}if(((L=2*(M=K[l=C+1])+R[l]-256)<0)||(M<128&&L<0)){K[l]=0}else{if(L>255){K[l]=255}else{K[l]=L}}if(((z=2*(A=K[f=C+2])+R[f]-256)<0)||(A<128&&z<0)){K[f]=0}else{if(z>255){K[f]=255}else{K[f]=z}}}v=true;break;case"vividlight":while(H--){if((s=K[C-=4])<128){if(s){if((q=255-((255-R[C])<<8)/(2*s))<0){K[C]=0}else{K[C]=q}}else{K[C]=0}}else{if((q=(o=2*s-256))<255){if((q=(R[C]<<8)/(255-o))>255){K[C]=255}else{K[C]=q}}else{if(q<0){K[C]=0}else{K[C]=q}}}if((M=K[l=C+1])<128){if(M){if((L=255-((255-R[l])<<8)/(2*M))<0){K[l]=0}else{K[l]=L}}else{K[l]=0}}else{if((L=(J=2*M-256))<255){if((L=(R[l]<<8)/(255-J))>255){K[l]=255}else{K[l]=L}}else{if(L<0){K[l]=0}else{K[l]=L}}}if((A=K[f=C+2])<128){if(A){if((z=255-((255-R[f])<<8)/(2*A))<0){K[f]=0}else{K[f]=z}}else{K[f]=0}}else{if((z=(y=2*A-256))<255){if((z=(R[f]<<8)/(255-y))>255){K[f]=255}else{K[f]=z}}else{if(z<0){K[f]=0}else{K[f]=z}}}}v=true;break;case"pinlight":while(H--){if((s=K[C-=4])<128){if((u=R[C])<(o=2*s)){K[C]=u}else{K[C]=o}}else{if((u=R[C])>(o=2*s-256)){K[C]=u}else{K[C]=o}}if((M=K[l=C+1])<128){if((N=R[l])<(J=2*M)){K[l]=N}else{K[l]=J}}else{if((N=R[l])>(J=2*M-256)){K[l]=N}else{K[l]=J}}if((s=K[f=C+2])<128){if((u=R[f])<(o=2*s)){K[f]=u}else{K[f]=o}}else{if((u=R[f])>(o=2*s-256)){K[f]=u}else{K[f]=o}}}v=true;break;case"hardmix":while(H--){if((s=K[C-=4])<128){if(255-((255-R[C])<<8)/(2*s)<128||s==0){K[C]=0}else{K[C]=255}}else{if((o=2*s-256)<255&&(R[C]<<8)/(255-o)<128){K[C]=0}else{K[C]=255}}if((M=K[l=C+1])<128){if(255-((255-R[l])<<8)/(2*M)<128||M==0){K[l]=0}else{K[l]=255}}else{if((J=2*M-256)<255&&(R[l]<<8)/(255-J)<128){K[l]=0}else{K[l]=255}}if((A=K[f=C+2])<128){if(255-((255-R[f])<<8)/(2*A)<128||A==0){K[f]=0}else{K[f]=255}}else{if((y=2*A-256)<255&&(R[f]<<8)/(255-y)<128){K[f]=0}else{K[f]=255}}}v=true;break}if(v){Q.putImageData(n,0,0)}if(k!=1&&!Pixastic.Client.hasGlobalAlpha()){var H=F*O;var a=k;var d=1-k;while(H--){var C=H*4;var G=(R[C]*d+K[C]*a)>>0;var P=(R[C+1]*d+K[C+1]*a)>>0;var S=(R[C+2]*d+K[C+2]*a)>>0;R[C]=G;R[C+1]=P;R[C+2]=S}c.useData=true}else{var x=c.canvas.getContext("2d");x.save();x.globalAlpha=k;x.drawImage(E,0,0,D.width,D.height,D.left,D.top,D.width,D.height);x.globalAlpha=1;x.restore()}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.blur={process:function(z){if(typeof z.options.fixMargin=="undefined"){z.options.fixMargin=true}if(Pixastic.Client.hasCanvasImageData()){var A=Pixastic.prepareData(z);var c=Pixastic.prepareData(z,true);var e=[[0,1,0],[1,2,1],[0,1,0]];var n=0;for(var r=0;r<3;r++){for(var p=0;p<3;p++){n+=e[r][p]}}n=1/(n*2);var a=z.options.rect;var l=a.width;var t=a.height;var f=l*4;var g=t;do{var u=(g-1)*f;var b=(g==1)?0:g-2;var v=(g==t)?g-1:g;var m=b*l*4;var o=v*l*4;var k=l;do{var d=u+(k*4-4);var q=m+((k==1)?0:k-2)*4;var s=o+((k==l)?k-1:k)*4;A[d]=((c[q]+c[d-4]+c[d+4]+c[s])*2+c[d]*4)*n;A[d+1]=((c[q+1]+c[d-3]+c[d+5]+c[s+1])*2+c[d+1]*4)*n;A[d+2]=((c[q+2]+c[d-2]+c[d+6]+c[s+2])*2+c[d+2]*4)*n}while(--k)}while(--g);return true}else{if(Pixastic.Client.isIE()){z.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)";if(z.options.fixMargin){z.image.style.marginLeft=(parseInt(z.image.style.marginLeft,10)||0)-2+"px";z.image.style.marginTop=(parseInt(z.image.style.marginTop,10)||0)-2+"px"}return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE())}};Pixastic.Actions.blurfast={process:function(c){var g=parseFloat(c.options.amount)||0;var h=!!(c.options.clear&&c.options.clear!="false");g=Math.max(0,Math.min(5,g));if(Pixastic.Client.hasCanvas()){var o=c.options.rect;var q=c.canvas.getContext("2d");q.save();q.beginPath();q.rect(o.left,o.top,o.width,o.height);q.clip();var b=2;var m=Math.round(c.width/b);var p=Math.round(c.height/b);var a=document.createElement("canvas");a.width=m;a.height=p;var h=false;var n=Math.round(g*20);var f=a.getContext("2d");for(var e=0;e<n;e++){var d=Math.max(1,Math.round(m-e));var l=Math.max(1,Math.round(p-e));f.clearRect(0,0,m,p);f.drawImage(c.canvas,0,0,c.width,c.height,0,0,d,l);if(h){q.clearRect(o.left,o.top,o.width,o.height)}q.drawImage(a,0,0,d,l,0,0,c.width,c.height)}q.restore();c.useData=false;return true}else{if(Pixastic.Client.isIE()){var k=10*g;c.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius="+k+")";if(c.options.fixMargin||1){c.image.style.marginLeft=(parseInt(c.image.style.marginLeft,10)||0)-Math.round(k)+"px";c.image.style.marginTop=(parseInt(c.image.style.marginTop,10)||0)-Math.round(k)+"px"}return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvas()||Pixastic.Client.isIE())}};Pixastic.Actions.brightness={process:function(u){var x=parseInt(u.options.brightness,10)||0;var d=parseFloat(u.options.contrast)||0;var o=!!(u.options.legacy&&u.options.legacy!="false");if(o){x=Math.min(150,Math.max(-150,x))}else{var y=1+Math.min(150,Math.max(-150,x))/150}d=Math.max(0,d+1);if(Pixastic.Client.hasCanvasImageData()){var z=Pixastic.prepareData(u);var a=u.options.rect;var e=a.width;var q=a.height;var n=e*q;var c=n*4,l,f;var t,k;if(d!=1){if(o){t=d;k=(x-128)*d+128}else{t=y*d;k=-d*128+128}}else{if(o){t=1;k=x}else{t=y;k=0}}var m,s,v;while(n--){if((m=z[c-=4]*t+k)>255){z[c]=255}else{if(m<0){z[c]=0}else{z[c]=m}}if((s=z[l=c+1]*t+k)>255){z[l]=255}else{if(s<0){z[l]=0}else{z[l]=s}}if((v=z[f=c+2]*t+k)>255){z[f]=255}else{if(v<0){z[f]=0}else{z[f]=v}}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.coloradjust={process:function(e){var d=parseFloat(e.options.red)||0;var f=parseFloat(e.options.green)||0;var s=parseFloat(e.options.blue)||0;d=Math.round(d*255);f=Math.round(f*255);s=Math.round(s*255);if(Pixastic.Client.hasCanvasImageData()){var h=Pixastic.prepareData(e);var q=e.options.rect;var c=q.width*q.height;var l=c*4,o,m;var a,k,n;while(c--){l-=4;if(d){if((a=h[l]+d)<0){h[l]=0}else{if(a>255){h[l]=255}else{h[l]=a}}}if(f){if((k=h[o=l+1]+f)<0){h[o]=0}else{if(k>255){h[o]=255}else{h[o]=k}}}if(s){if((n=h[m=l+2]+s)<0){h[m]=0}else{if(n>255){h[m]=255}else{h[m]=n}}}}return true}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData())}};Pixastic.Actions.colorhistogram={array256:function(a){arr=[];for(var b=0;b<256;b++){arr[b]=a}return arr},process:function(s){var e=[];if(typeof s.options.returnValue!="object"){s.options.returnValue={rvals:[],gvals:[],bvals:[]}}var l=!!(s.options.paint);var t=s.options.returnValue;if(typeof t.values!="array"){t.rvals=[];t.gvals=[];t.bvals=[]}if(Pixastic.Client.hasCanvasImageData()){var w=Pixastic.prepareData(s);s.useData=false;var r=this.array256(0);var f=this.array256(0);var a=this.array256(0);var d=s.options.rect;var m=d.width*d.height;var g=m*4;while(m--){r[w[g-=4]]++;f[w[g+1]]++;a[w[g+2]]++}t.rvals=r;t.gvals=f;t.bvals=a;if(l){var n=s.canvas.getContext("2d");var k=[r,f,a];for(var h=0;h<3;h++){var u=(h+1)*s.height/3;var q=0;for(var o=0;o<256;o++){if(k[h][o]>q){q=k[h][o]}}var b=s.height/3/q;var c=s.width/256;if(h==0){n.fillStyle="rgba(255,0,0,0.5)"}else{if(h==1){n.fillStyle="rgba(0,255,0,0.5)"}else{if(h==2){n.fillStyle="rgba(0,0,255,0.5)"}}}for(var o=0;o<256;o++){n.fillRect(o*c,s.height-b*k[h][o]-s.height+u,c,k[h][o]*b)}}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.crop={process:function(f){if(Pixastic.Client.hasCanvas()){var c=f.options.rect;var b=c.width;var a=c.height;var e=c.top;var d=c.left;if(typeof f.options.left!="undefined"){d=parseInt(f.options.left,10)}if(typeof f.options.top!="undefined"){e=parseInt(f.options.top,10)}if(typeof f.options.height!="undefined"){b=parseInt(f.options.width,10)}if(typeof f.options.height!="undefined"){a=parseInt(f.options.height,10)}if(d<0){d=0}if(d>f.width-1){d=f.width-1}if(e<0){e=0}if(e>f.height-1){e=f.height-1}if(b<1){b=1}if(d+b>f.width){b=f.width-d}if(a<1){a=1}if(e+a>f.height){a=f.height-e}var g=document.createElement("canvas");g.width=f.width;g.height=f.height;g.getContext("2d").drawImage(f.canvas,0,0);f.canvas.width=b;f.canvas.height=a;f.canvas.getContext("2d").clearRect(0,0,b,a);f.canvas.getContext("2d").drawImage(g,d,e,b,a,0,0,b,a);f.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.desaturate={process:function(b){var c=!!(b.options.average&&b.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var d=Pixastic.prepareData(b);var l=b.options.rect;var m=l.width;var e=l.height;var a=m*e;var f=a*4,k,g;if(c){while(a--){d[f-=4]=d[k=f+1]=d[g=f+2]=(d[f]+d[k]+d[g])/3}}else{while(a--){d[f-=4]=d[k=f+1]=d[g=f+2]=(d[f]*0.3+d[k]*0.59+d[g]*0.11)}}return true}else{if(Pixastic.Client.isIE()){b.image.style.filter+=" gray";return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE())}};Pixastic.Actions.edges={process:function(F){var u=!!(F.options.mono&&F.options.mono!="false");var q=!!(F.options.invert&&F.options.invert!="false");if(Pixastic.Client.hasCanvasImageData()){var I=Pixastic.prepareData(F);var e=Pixastic.prepareData(F,true);var E=-1/8;var k=[[E,E,E],[E,1,E],[E,E,E]];weight=1/E;var a=F.options.rect;var o=a.width;var A=a.height;var l=o*4;var m=A;do{var C=(m-1)*l;var D=(m==A)?m-1:m;var d=(m==1)?0:m-2;var p=d*o*4;var s=D*o*4;var n=o;do{var f=C+(n*4-4);var v=p+((n==1)?0:n-2)*4;var z=s+((n==o)?n-1:n)*4;var t=((e[v-4]+e[v]+e[v+4]+e[f-4]+e[f+4]+e[z-4]+e[z]+e[z+4])*E+e[f])*weight;var B=((e[v-3]+e[v+1]+e[v+5]+e[f-3]+e[f+5]+e[z-3]+e[z+1]+e[z+5])*E+e[f+1])*weight;var G=((e[v-2]+e[v+2]+e[v+6]+e[f-2]+e[f+6]+e[z-2]+e[z+2]+e[z+6])*E+e[f+2])*weight;if(u){var H=(t*0.3+B*0.59+G*0.11)||0;if(q){H=255-H}if(H<0){H=0}if(H>255){H=255}t=B=G=H}else{if(q){t=255-t;B=255-B;G=255-G}if(t<0){t=0}if(B<0){B=0}if(G<0){G=0}if(t>255){t=255}if(B>255){B=255}if(G>255){G=255}}I[f]=t;I[f+1]=B;I[f+2]=G}while(--n)}while(--m);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.edges2={process:function(K){if(Pixastic.Client.hasCanvasImageData()){var O=Pixastic.prepareData(K);var k=Pixastic.prepareData(K,true);var d=K.options.rect;var u=d.width;var H=d.height;var o=u*4;var f=o+4;var A=H-1;var J=u-1;for(var q=1;q<A;++q){var e=f-4;var v=e-o;var D=e+o;var G=-k[v]-k[e]-k[D];var c=-k[++v]-k[++e]-k[++D];var n=-k[++v]-k[++e]-k[++D];var p=k[v+=2];var B=k[++v];var N=k[++v];var C=k[e+=2];var M=k[++e];var l=k[++e];var t=k[D+=2];var E=k[++D];var a=k[++D];var F=-p-C-t;var P=-B-M-E;var m=-N-l-a;for(var s=1;s<J;++s){e=f+4;v=e-o;D=e+o;var z=127+G-p-(C*-8)-t;var I=127+c-B-(M*-8)-E;var L=127+n-N-(l*-8)-a;G=F;c=P;n=m;p=k[v];B=k[++v];N=k[++v];C=k[e];M=k[++e];l=k[++e];t=k[D];E=k[++D];a=k[++D];z+=(F=-p-C-t);I+=(P=-B-M-E);L+=(m=-N-l-a);if(z>255){z=255}if(I>255){I=255}if(L>255){L=255}if(z<0){z=0}if(I<0){I=0}if(L<0){L=0}O[f]=z;O[++f]=I;O[++f]=L;f+=2}f+=8}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.emboss={process:function(I){var N=parseFloat(I.options.strength)||1;var A=typeof I.options.greyLevel!="undefined"?parseInt(I.options.greyLevel):180;var L=I.options.direction||"topleft";var C=!!(I.options.blend&&I.options.blend!="false");var J=0;var M=0;switch(L){case"topleft":J=-1;M=-1;break;case"top":J=-1;M=0;break;case"topright":J=-1;M=1;break;case"right":J=0;M=1;break;case"bottomright":J=1;M=1;break;case"bottom":J=1;M=0;break;case"bottomleft":J=1;M=-1;break;case"left":J=0;M=-1;break}if(Pixastic.Client.hasCanvasImageData()){var O=Pixastic.prepareData(I);var d=Pixastic.prepareData(I,true);var D=!!I.options.invertAlpha;var a=I.options.rect;var q=a.width;var E=a.height;var n=q*4;var o=E;do{var G=(o-1)*n;var s=J;if(o+s<1){s=0}if(o+s>E){s=0}var P=(o-1+s)*q*4;var p=q;do{var f=G+(p-1)*4;var t=M;if(p+t<1){t=0}if(p+t>q){t=0}var e=P+(p-1+t)*4;var l=d[f]-d[e];var u=d[f+1]-d[e+1];var B=d[f+2]-d[e+2];var H=l;var z=H>0?H:-H;var k=u>0?u:-u;var m=B>0?B:-B;if(k>z){H=u}if(m>z){H=B}H*=N;if(C){var v=O[f]+H;var F=O[f+1]+H;var K=O[f+2]+H;O[f]=(v>255)?255:(v<0?0:v);O[f+1]=(F>255)?255:(F<0?0:F);O[f+2]=(K>255)?255:(K<0?0:K)}else{var c=A-H;if(c<0){c=0}else{if(c>255){c=255}}O[f]=O[f+1]=O[f+2]=c}}while(--p)}while(--o);return true}else{if(Pixastic.Client.isIE()){I.image.style.filter+=" progid:DXImageTransform.Microsoft.emboss()";return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE())}};Pixastic.Actions.flip={process:function(d){var b=d.options.rect;var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(d.image,b.left,b.top,b.width,b.height,0,0,b.width,b.height);var a=d.canvas.getContext("2d");a.clearRect(b.left,b.top,b.width,b.height);if(d.options.axis=="horizontal"){a.scale(-1,1);a.drawImage(c,-b.left-b.width,b.top,b.width,b.height)}else{a.scale(1,-1);a.drawImage(c,b.left,-b.top-b.height,b.width,b.height)}d.useData=false;return true},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.fliph={process:function(d){if(Pixastic.Client.hasCanvas()){var b=d.options.rect;var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(d.image,b.left,b.top,b.width,b.height,0,0,b.width,b.height);var a=d.canvas.getContext("2d");a.clearRect(b.left,b.top,b.width,b.height);a.scale(-1,1);a.drawImage(c,-b.left-b.width,b.top,b.width,b.height);d.useData=false;return true}else{if(Pixastic.Client.isIE()){d.image.style.filter+=" fliph";return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvas()||Pixastic.Client.isIE())}};Pixastic.Actions.flipv={process:function(d){if(Pixastic.Client.hasCanvas()){var b=d.options.rect;var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(d.image,b.left,b.top,b.width,b.height,0,0,b.width,b.height);var a=d.canvas.getContext("2d");a.clearRect(b.left,b.top,b.width,b.height);a.scale(1,-1);a.drawImage(c,b.left,-b.top-b.height,b.width,b.height);d.useData=false;return true}else{if(Pixastic.Client.isIE()){d.image.style.filter+=" flipv";return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvas()||Pixastic.Client.isIE())}};Pixastic.Actions.glow={process:function(v){var d=(parseFloat(v.options.amount)||0);var t=parseFloat(v.options.radius)||0;d=Math.min(1,Math.max(0,d));t=Math.min(5,Math.max(0,t));if(Pixastic.Client.hasCanvasImageData()){var a=v.options.rect;var m=document.createElement("canvas");m.width=v.width;m.height=v.height;var b=m.getContext("2d");b.drawImage(v.canvas,0,0);var z=2;var h=Math.round(v.width/z);var q=Math.round(v.height/z);var n=document.createElement("canvas");n.width=h;n.height=q;var l=true;var s=Math.round(t*20);var u=n.getContext("2d");for(var r=0;r<s;r++){var o=Math.max(1,Math.round(h-r));var x=Math.max(1,Math.round(q-r));u.clearRect(0,0,h,q);u.drawImage(m,0,0,v.width,v.height,0,0,o,x);b.clearRect(0,0,v.width,v.height);b.drawImage(n,0,0,o,x,0,0,v.width,v.height)}var y=Pixastic.prepareData(v);var w=Pixastic.prepareData({canvas:m,options:v.options});var k=a.width*a.height;var c=k*4,g=c+1,f=c+2,e=c+3;while(k--){if((y[c-=4]+=d*w[c])>255){y[c]=255}if((y[g-=4]+=d*w[g])>255){y[g]=255}if((y[f-=4]+=d*w[f])>255){y[f]=255}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.histogram={process:function(s){var e=!!(s.options.average&&s.options.average!="false");var l=!!(s.options.paint&&s.options.paint!="false");var o=s.options.color||"rgba(255,255,255,0.5)";var d=[];if(typeof s.options.returnValue!="object"){s.options.returnValue={values:[]}}var u=s.options.returnValue;if(typeof u.values!="array"){u.values=[]}d=u.values;if(Pixastic.Client.hasCanvasImageData()){var v=Pixastic.prepareData(s);s.useData=false;for(var q=0;q<256;q++){d[q]=0}var c=s.options.rect;var m=c.width*c.height;var f=m*4,k=f+1,h=f+2,g=f+3;var t=Math.round;if(e){while(m--){d[t((v[f-=4]+v[f+1]+v[f+2])/3)]++}}else{while(m--){d[t(v[f-=4]*0.3+v[f+1]*0.59+v[f+2]*0.11)]++}}if(l){var r=0;for(var q=0;q<256;q++){if(d[q]>r){r=d[q]}}var a=s.height/r;var b=s.width/256;var n=s.canvas.getContext("2d");n.fillStyle=o;for(var q=0;q<256;q++){n.fillRect(q*b,s.height-a*d[q],b,d[q]*a)}}u.values=d;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.hsl={process:function(J){var d=parseInt(J.options.hue,10)||0;var e=(parseInt(J.options.saturation,10)||0)/100;var L=(parseInt(J.options.lightness,10)||0)/100;if(e<0){var k=1+e}else{var k=1+e*2}d=(d%360)/360;var o=d*6;var N=1/255;var f=L*255;var C=1+L;var A=1-L;if(Pixastic.Client.hasCanvasImageData()){var M=Pixastic.prepareData(J);var a=J.options.rect;var z=a.width*a.height;var c=z*4,y=c+1,w=c+2,t=c+3;while(z--){var x=M[c-=4];var H=M[y=c+1];var K=M[w=c+2];if(d!=0||e!=0){var F=x;if(H>F){F=H}if(K>F){F=K}var B=x;if(H<B){B=H}if(K<B){B=K}var I=(F-B);var E=(B+F)/510;if(E>0){if(I>0){if(E<=0.5){var u=I/(F+B)*k;if(u>1){u=1}var q=(E*(1+u))}else{var u=I/(510-F-B)*k;if(u>1){u=1}var q=(E+u-E*u)}if(x==F){if(H==B){var G=5+((F-K)/I)+o}else{var G=1-((F-H)/I)+o}}else{if(H==F){if(K==B){var G=1+((F-x)/I)+o}else{var G=3-((F-K)/I)+o}}else{if(x==B){var G=3+((F-H)/I)+o}else{var G=5-((F-x)/I)+o}}}if(G<0){G+=6}if(G>=6){G-=6}var D=(E+E-q);var n=G>>0;if(n==0){x=q*255;H=(D+((q-D)*(G-n)))*255;K=D*255}else{if(n==1){x=(q-((q-D)*(G-n)))*255;H=q*255;K=D*255}else{if(n==2){x=D*255;H=q*255;K=(D+((q-D)*(G-n)))*255}else{if(n==3){x=D*255;H=(q-((q-D)*(G-n)))*255;K=q*255}else{if(n==4){x=(D+((q-D)*(G-n)))*255;H=D*255;K=q*255}else{if(n==5){x=q*255;H=D*255;K=(q-((q-D)*(G-n)))*255}}}}}}}}}if(L<0){x*=C;H*=C;K*=C}else{if(L>0){x=x*A+f;H=H*A+f;K=K*A+f}}if(x<0){M[c]=0}else{if(x>255){M[c]=255}else{M[c]=x}}if(H<0){M[y]=0}else{if(H>255){M[y]=255}else{M[y]=H}}if(K<0){M[w]=0}else{if(K>255){M[w]=255}else{M[w]=K}}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.invert={process:function(c){if(Pixastic.Client.hasCanvasImageData()){var d=Pixastic.prepareData(c);var b=!!c.options.invertAlpha;var h=c.options.rect;var a=h.width*h.height;var e=a*4,k=e+1,g=e+2,f=e+3;while(a--){d[e-=4]=255-d[e];d[k-=4]=255-d[k];d[g-=4]=255-d[g];if(b){d[f-=4]=255-d[f]}}return true}else{if(Pixastic.Client.isIE()){c.image.style.filter+=" invert";return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE())}};Pixastic.Actions.laplace={process:function(F){var H=1;var s=!!(F.options.invert&&F.options.invert!="false");var c=parseFloat(F.options.edgeStrength)||0;var v=parseInt(F.options.greyLevel)||0;c=-c;if(Pixastic.Client.hasCanvasImageData()){var J=Pixastic.prepareData(F);var e=Pixastic.prepareData(F,true);var k=[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]];var q=1/8;var a=F.options.rect;var o=a.width;var B=a.height;var l=o*4;var m=B;do{var D=(m-1)*l;var E=(m==B)?m-1:m;var d=(m==1)?0:m-2;var p=d*o*4;var t=E*o*4;var n=o;do{var f=D+(n*4-4);var z=p+((n==1)?0:n-2)*4;var A=t+((n==o)?n-1:n)*4;var u=((-e[z-4]-e[z]-e[z+4]-e[f-4]-e[f+4]-e[A-4]-e[A]-e[A+4])+e[f]*8)*q;var C=((-e[z-3]-e[z+1]-e[z+5]-e[f-3]-e[f+5]-e[A-3]-e[A+1]-e[A+5])+e[f+1]*8)*q;var G=((-e[z-2]-e[z+2]-e[z+6]-e[f-2]-e[f+6]-e[A-2]-e[A+2]-e[A+6])+e[f+2]*8)*q;var I=((u+C+G)/3)+v;if(c!=0){if(I>127){I+=((I+1)-128)*c}else{if(I<127){I-=(I+1)*c}}}if(s){I=255-I}if(I<0){I=0}if(I>255){I=255}J[f]=J[f+1]=J[f+2]=I}while(--n)}while(--m);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.lighten={process:function(c){var f=parseFloat(c.options.amount)||0;f=Math.max(-1,Math.min(1,f));if(Pixastic.Client.hasCanvasImageData()){var e=Pixastic.prepareData(c);var k=c.options.rect;var a=k.width*k.height;var g=a*4,l=g+1,h=g+2;var b=f+1;while(a--){if((e[g-=4]=e[g]*b)>255){e[g]=255}if((e[l-=4]=e[l]*b)>255){e[l]=255}if((e[h-=4]=e[h]*b)>255){e[h]=255}}return true}else{if(Pixastic.Client.isIE()){var d=c.image;if(f<0){d.style.filter+=" light()";d.filters[d.filters.length-1].addAmbient(255,255,255,100*-f)}else{if(f>0){d.style.filter+=" light()";d.filters[d.filters.length-1].addAmbient(255,255,255,100);d.filters[d.filters.length-1].addAmbient(255,255,255,100*f)}}return true}}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE())}};Pixastic.Actions.mosaic={process:function(c){var n=Math.max(1,parseInt(c.options.blockSize,10));if(Pixastic.Client.hasCanvasImageData()){var p=c.options.rect;var r=p.width;var k=p.height;var d=r*4;var o=k;var s=c.canvas.getContext("2d");var b=document.createElement("canvas");b.width=b.height=1;var m=b.getContext("2d");var a=document.createElement("canvas");a.width=r;a.height=k;var g=a.getContext("2d");g.drawImage(c.canvas,p.left,p.top,r,k,0,0,r,k);for(var o=0;o<k;o+=n){for(var q=0;q<r;q+=n){var l=n;var f=n;if(l+q>r){l=r-q}if(f+o>k){f=k-o}m.drawImage(a,q,o,l,f,0,0,1,1);var e=m.getImageData(0,0,1,1).data;s.fillStyle="rgb("+e[0]+","+e[1]+","+e[2]+")";s.fillRect(p.left+q,p.top+o,n,n)}}c.useData=false;return true}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData())}};Pixastic.Actions.noise={process:function(z){var f=0;var B=0;var s=false;if(typeof z.options.amount!="undefined"){f=parseFloat(z.options.amount)||0}if(typeof z.options.strength!="undefined"){B=parseFloat(z.options.strength)||0}if(typeof z.options.mono!="undefined"){s=!!(z.options.mono&&z.options.mono!="false")}f=Math.max(0,Math.min(1,f));B=Math.max(0,Math.min(1,B));var o=128*B;var p=o/2;if(Pixastic.Client.hasCanvasImageData()){var C=Pixastic.prepareData(z);var c=z.options.rect;var n=c.width;var t=c.height;var k=n*4;var l=t;var a=Math.random;do{var v=(l-1)*k;var m=n;do{var e=v+(m-1)*4;if(a()<f){if(s){var d=-p+a()*o;var q=C[e]+d;var u=C[e+1]+d;var A=C[e+2]+d}else{var q=C[e]-p+(a()*o);var u=C[e+1]-p+(a()*o);var A=C[e+2]-p+(a()*o)}if(q<0){q=0}if(u<0){u=0}if(A<0){A=0}if(q>255){q=255}if(u>255){u=255}if(A>255){A=255}C[e]=q;C[e+1]=u;C[e+2]=A}}while(--m)}while(--l);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.posterize={process:function(e){var u=256;if(typeof e.options.levels!="undefined"){u=parseInt(e.options.levels,10)||1}if(Pixastic.Client.hasCanvasImageData()){var l=Pixastic.prepareData(e);u=Math.max(2,Math.min(256,u));var c=256/u;var s=256/(u-1);var q=e.options.rect;var v=q.width;var m=q.height;var d=v*4;var p=m;do{var k=(p-1)*d;var t=v;do{var f=k+(t-1)*4;var a=s*((l[f]/c)>>0);var n=s*((l[f+1]/c)>>0);var o=s*((l[f+2]/c)>>0);if(a>255){a=255}if(n>255){n=255}if(o>255){o=255}l[f]=a;l[f+1]=n;l[f+2]=o}while(--t)}while(--p);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.pointillize={process:function(F){var k=Math.max(1,parseInt(F.options.radius,10));var n=Math.min(5,Math.max(0,parseFloat(F.options.density)||0));var t=Math.max(0,parseFloat(F.options.noise)||0);var G=!!(F.options.transparent&&F.options.transparent!="false");if(Pixastic.Client.hasCanvasImageData()){var d=F.options.rect;var s=d.width;var C=d.height;var o=s*4;var p=C;var v=F.canvas.getContext("2d");var E=F.canvas.width;var e=F.canvas.height;var l=document.createElement("canvas");l.width=l.height=1;var m=l.getContext("2d");var z=document.createElement("canvas");z.width=s;z.height=C;var D=z.getContext("2d");D.drawImage(F.canvas,d.left,d.top,s,C,0,0,s,C);var r=k*2;if(G){v.clearRect(d.left,d.top,d.width,d.height)}var c=k*t;var u=1/n;for(var p=0;p<C+k;p+=r*u){for(var q=0;q<s+k;q+=r*u){rndX=t?(q+((Math.random()*2-1)*c))>>0:q;rndY=t?(p+((Math.random()*2-1)*c))>>0:p;var B=rndX-k;var A=rndY-k;if(B<0){B=0}if(A<0){A=0}var g=rndX+d.left;var f=rndY+d.top;if(g<0){g=0}if(g>E){g=E}if(f<0){f=0}if(f>e){f=e}var b=r;var a=r;if(b+B>s){b=s-B}if(a+A>C){a=C-A}if(b<1){b=1}if(a<1){a=1}m.drawImage(z,B,A,b,a,0,0,1,1);var H=m.getImageData(0,0,1,1).data;v.fillStyle="rgb("+H[0]+","+H[1]+","+H[2]+")";v.beginPath();v.arc(g,f,k,0,Math.PI*2,true);v.closePath();v.fill()}}F.useData=false;return true}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData())}};Pixastic.Actions.removenoise={process:function(G){if(Pixastic.Client.hasCanvasImageData()){var I=Pixastic.prepareData(G);var c=G.options.rect;var s=c.width;var C=c.height;var p=s*4;var q=C;do{var E=(q-1)*p;var F=(q==C)?q-1:q;var e=(q==1)?0:q-2;var t=e*s*4;var u=F*s*4;var r=s;do{var k=E+(r*4-4);var B=t+((r==1)?0:r-2)*4;var D=u+((r==s)?r-1:r)*4;var b,K,f,d,o,n;b=K=I[B];var A=I[k-4],z=I[k+4],v=I[D];if(A<b){b=A}if(z<b){b=z}if(v<b){b=v}if(A>K){K=A}if(z>K){K=z}if(v>K){K=v}f=d=I[B+1];var a=I[k-3],J=I[k+5],H=I[D+1];if(a<f){f=a}if(J<f){f=J}if(H<f){f=H}if(a>d){d=a}if(J>d){d=J}if(H>d){d=H}o=n=I[B+2];var m=I[k-2],l=I[k+6],g=I[D+2];if(m<o){o=m}if(l<o){o=l}if(g<o){o=g}if(m>n){n=m}if(l>n){n=l}if(g>n){n=g}if(I[k]>K){I[k]=K}else{if(I[k]<b){I[k]=b}}if(I[k+1]>d){I[k+1]=d}else{if(I[k+1]<f){I[k+1]=f}}if(I[k+2]>n){I[k+2]=n}else{if(I[k+2]<o){I[k+2]=o}}}while(--r)}while(--q);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.resize={process:function(d){if(Pixastic.Client.hasCanvas()){var c=parseInt(d.options.width,10);var a=parseInt(d.options.height,10);var b=d.canvas;if(c<1){c=1}if(c<2){c=2}var e=document.createElement("canvas");e.width=c;e.height=a;e.getContext("2d").drawImage(b,0,0,c,a);b.width=c;b.height=a;b.getContext("2d").drawImage(e,0,0);d.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.rotate={process:function(f){if(Pixastic.Client.hasCanvas()){var d=f.canvas;var c=f.width;var n=f.height;var b=document.createElement("canvas");b.width=c;b.height=n;b.getContext("2d").drawImage(d,0,0,c,n);var e=-parseFloat(f.options.angle)*Math.PI/180;var m=e;if(m>Math.PI*0.5){m=Math.PI-m}if(m<-Math.PI*0.5){m=-Math.PI-m}var h=Math.sqrt(c*c+n*n);var l=Math.abs(m)-Math.abs(Math.atan2(n,c));var k=Math.abs(m)+Math.abs(Math.atan2(n,c));var g=Math.abs(Math.cos(l)*h);var a=Math.abs(Math.sin(k)*h);d.width=g;d.height=a;var o=d.getContext("2d");o.translate(g/2,a/2);o.rotate(e);o.drawImage(b,-c/2,-n/2);f.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.sepia={process:function(z){var n=(parseInt(z.options.mode,10)||0);if(n<0){n=0}if(n>1){n=1}if(Pixastic.Client.hasCanvasImageData()){var B=Pixastic.prepareData(z);var a=z.options.rect;var m=a.width;var s=a.height;var f=m*4;var k=s;do{var u=(k-1)*f;var l=m;do{var c=u+(l-1)*4;if(n){var v=B[c]*0.299+B[c+1]*0.587+B[c+2]*0.114;var o=(v+39);var t=(v+14);var A=(v-36)}else{var e=B[c];var p=B[c+1];var q=B[c+2];var o=(e*0.393+p*0.769+q*0.189);var t=(e*0.349+p*0.686+q*0.168);var A=(e*0.272+p*0.534+q*0.131)}if(o<0){o=0}if(o>255){o=255}if(t<0){t=0}if(t>255){t=255}if(A<0){A=0}if(A>255){A=255}B[c]=o;B[c+1]=t;B[c+2]=A}while(--l)}while(--k);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.sharpen={process:function(G){var I=0;if(typeof G.options.amount!="undefined"){I=parseFloat(G.options.amount)||0}if(I<0){I=0}if(I>1){I=1}if(Pixastic.Client.hasCanvasImageData()){var J=Pixastic.prepareData(G);var d=Pixastic.prepareData(G,true);var E=15;var t=1+3*I;var f=[[0,-t,0],[-t,E,-t],[0,-t,0]];var p=0;for(var z=0;z<3;z++){for(var u=0;u<3;u++){p+=f[z][u]}}p=1/p;var a=G.options.rect;var n=a.width;var B=a.height;E*=p;t*=p;var k=n*4;var l=B;do{var D=(l-1)*k;var F=(l==B)?l-1:l;var c=(l==1)?0:l-2;var o=c*k;var q=F*k;var m=n;do{var e=D+(m*4-4);var v=o+((m==1)?0:m-2)*4;var A=q+((m==n)?m-1:m)*4;var s=((-d[v]-d[e-4]-d[e+4]-d[A])*t+d[e]*E);var C=((-d[v+1]-d[e-3]-d[e+5]-d[A+1])*t+d[e+1]*E);var H=((-d[v+2]-d[e-2]-d[e+6]-d[A+2])*t+d[e+2]*E);if(s<0){s=0}if(C<0){C=0}if(H<0){H=0}if(s>255){s=255}if(C>255){C=255}if(H>255){H=255}J[e]=s;J[e+1]=C;J[e+2]=H}while(--m)}while(--l);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.solarize={process:function(c){var f=!!(c.options.average&&c.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var l=Pixastic.prepareData(c);var q=c.options.rect;var t=q.width;var m=q.height;var d=t*4;var p=m;do{var k=(p-1)*d;var s=t;do{var e=k+(s-1)*4;var a=l[e];var n=l[e+1];var o=l[e+2];if(a>127){a=255-a}if(n>127){n=255-n}if(o>127){o=255-o}l[e]=a;l[e+1]=n;l[e+2]=o}while(--s)}while(--p);return true}},checkSupport:function(){return(Pixastic.Client.hasCanvasImageData())}};Pixastic.Actions.unsharpmask={process:function(G){var k=(parseFloat(G.options.amount)||0);var E=parseFloat(G.options.radius)||0;var d=parseFloat(G.options.threshold)||0;k=Math.min(500,Math.max(0,k))/2;E=Math.min(5,Math.max(0,E))/10;d=Math.min(255,Math.max(0,d));d--;var g=-d;k*=0.016;k++;if(Pixastic.Client.hasCanvasImageData()){var a=G.options.rect;var t=document.createElement("canvas");t.width=G.width;t.height=G.height;var b=t.getContext("2d");b.drawImage(G.canvas,0,0);var L=2;var r=Math.round(G.width/L);var z=Math.round(G.height/L);var u=document.createElement("canvas");u.width=r;u.height=z;var C=Math.round(E*20);var F=u.getContext("2d");for(var A=0;A<C;A++){var v=Math.max(1,Math.round(r-A));var J=Math.max(1,Math.round(z-A));F.clearRect(0,0,r,z);F.drawImage(t,0,0,G.width,G.height,0,0,v,J);b.clearRect(0,0,G.width,G.height);b.drawImage(u,0,0,v,J,0,0,G.width,G.height)}var K=Pixastic.prepareData(G);var H=Pixastic.prepareData({canvas:t,options:G.options});var p=a.width;var B=a.height;var m=p*4;var n=B;do{var D=(n-1)*m;var o=p;do{var e=D+(o*4-4);var I=K[e]-H[e];if(I>d||I<g){var l=H[e];l=k*I+l;K[e]=l>255?255:(l<0?0:l)}var c=K[e+1]-H[e+1];if(c>d||c<g){var q=H[e+1];q=k*c+q;K[e+1]=q>255?255:(q<0?0:q)}var f=K[e+2]-H[e+2];if(f>d||f<g){var s=H[e+2];s=k*f+s;K[e+2]=s>255?255:(s<0?0:s)}}while(--o)}while(--n);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};